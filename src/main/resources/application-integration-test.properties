# =============================================================================
# INTEGRATION TEST PROFILE CONFIGURATION
# =============================================================================
# This profile is specifically designed for INTEGRATION TESTS only.
# 
# STRATEGY: Use Testcontainers for real database testing
# - Integration Tests: Real Postgres + Redis, slower, more realistic
# - Unit Tests: H2 in-memory, fast, isolated
#
# WHY Testcontainers for Integration Tests?
# - üéØ Realism: Test with real Postgres + Redis
# - üîÑ Consistency: Same environment as production
# - üß™ Comprehensive: Test database interactions, transactions
# - üöÄ CI/CD: Docker containers in GitHub Actions
#
# WHY NOT H2 for Integration Tests?
# - ‚ö†Ô∏è Differences: H2 vs Postgres behavior
# - üéØ Limited: Can't test Postgres-specific features
# - üîÑ Inconsistency: Different from production
# =============================================================================

# Enable Testcontainers for integration tests
spring.testcontainers.enabled=true

# Disable Eureka for integration tests
eureka.client.enabled=false
spring.cloud.discovery.enabled=false

# Disable Elasticsearch for integration tests
search.elasticsearch.enabled=false
spring.data.elasticsearch.repositories.enabled=false

# Testcontainers will automatically configure:
# - spring.datasource.url (Postgres container)
# - spring.data.redis.host (Redis container)
# - spring.data.redis.port (Redis container)

# JPA/Hibernate Configuration
spring.jpa.hibernate.ddl-auto=create-drop
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.show-sql=false

# Redis Configuration (will be overridden by Testcontainers)
spring.data.redis.repositories.enabled=true
spring.session.store-type=redis
spring.cache.type=redis

# JWT Configuration for testing
jwt.secret=IntegrationTestJWTSecretKeyForUserServiceTestingPurposesOnly
jwt.issuer=yushan-user-service-integration
jwt.algorithm=HS256

# Logging for integration tests
logging.level.com.yushan.user_service=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.org.springframework.web=DEBUG
logging.level.org.springframework.testcontainers=INFO
logging.level.org.testcontainers=INFO

# =============================================================================
# NOTE: Testcontainers will automatically:
# 1. Start Postgres container
# 2. Start Redis container  
# 3. Configure Spring to use these containers
# 4. Clean up containers after tests
# =============================================================================

# Session configuration for integration tests
# Use Redis-backed sessions and avoid JDBC schema initialization to prevent
# accidental connections to the default datasource before Testcontainers wires it.
spring.session.jdbc.initialize-schema=never
